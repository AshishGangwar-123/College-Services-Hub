<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Request Service</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
.card-shadow{box-shadow:0 6px 18px rgba(0,0,0,0.08);}
.theme-light { --bg:#0f172a; --text:#1e293b; --card:#ffffff; }
body { background:var(--bg); color:var(--text); transition:.2s; font-family:sans-serif; }
.bg-card { background-color: var(--card); }
</style>
</head>
<body class="theme-light min-h-screen flex items-center justify-center p-4">

<div id="formPage" class="bg-card card-shadow p-6 rounded-xl w-full max-w-md">
  <h2 class="text-2xl font-semibold mb-4 text-center">Request Service</h2>
  <p class="text-sm text-slate-500 mb-2">
    <b>Fill this form for selected service:</b> <b id="selectedService"></b>
  </p>

  <form id="requestForm" class="space-y-3">
    <input required id="r_name" class="w-full p-2 border rounded" placeholder="Your Name">
    <input required id="r_email" class="w-full p-2 border rounded" placeholder="Your Email">
    <input required id="r_phone" class="w-full p-2 border rounded" placeholder="Phone / WhatsApp">
    <input required id="r_service" class="w-full p-2 border rounded" placeholder="Service Name" hidden>
    <textarea id="r_details" rows="4" class="w-full p-2 border rounded" placeholder="Project details / Requirements (optional)"></textarea>
    <button class="w-full bg-indigo-600 text-white py-2 rounded">Submit Request</button>
  </form>
</div>

<div id="successPage" class="hidden bg-card card-shadow p-6 rounded-xl w-full max-w-md text-center">
  <h2 class="text-2xl font-semibold mb-2 text-green-600">Request Submitted âœ”</h2>
  <p class="text-slate-500 mb-4">We will contact you shortly. Meanwhile, you can contact us directly:</p>

  <div class="flex justify-center gap-6 text-3xl">
    <a id="emailBtn" href="#" title="Email">ðŸ“§</a>
    <a id="waBtn" href="#" title="WhatsApp">ðŸ’¬</a>
  </div>

  <button id="backHome" class="mt-6 bg-indigo-600 text-white px-4 py-2 rounded">
    Back to Home
  </button>
</div>

<script>
// === CONFIGURATION ===
// Google Sheet / Form URL (yaha tum apna Google Form ka "POST" URL daaloge)
const GOOGLE_SHEET_URL = "https://docs.google.com/forms/u/0/d/e/1FAIpQLScSgQ2Qw_xwgSJ1Jj1U76ln8_KJYFphmMYYoim5_wYoor53EA/formResponse"; 

const STORAGE_KEY = "service_requests_v1";

function qsGet(name){
  const url = new URL(location.href);
  return url.searchParams.get(name);
}

// Save locally in localStorage (backup ke liye)
function saveRequest(data){
  const list = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
  list.unshift(data);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
}

// Escape HTML injection
function escapeHtml(s=''){ 
  return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); 
}

document.addEventListener('DOMContentLoaded', ()=>{
  // Pre-fill service if provided in query
  const pre = qsGet('service');
  if(pre) {
    document.getElementById('r_service').value = decodeURIComponent(pre);
    document.getElementById('selectedService').innerText = decodeURIComponent(pre);
  }

  const form = document.getElementById("requestForm");
  form.addEventListener("submit", e => {
    e.preventDefault();

    const req = {
      name: document.getElementById('r_name').value.trim(),
      email: document.getElementById('r_email').value.trim(),
      phone: document.getElementById('r_phone').value.trim(),
      service: document.getElementById('r_service').value.trim(),
      details: document.getElementById('r_details').value.trim(),
      date: new Date().toLocaleString()
    };

    saveRequest(req); // localStorage me save

    // === Google Sheets Integration ===
    // Note: Tumhe Google Form ke input names check karne honge (entry.xxxxx)
    const formData = new FormData();
    formData.append("entry.1704972737", req.name);
    formData.append("entry.1430795574", req.email);
    formData.append("entry.107083425", req.phone);
    formData.append("entry.1704585229", req.service);
    formData.append("entry.835843381", req.details);

    fetch(GOOGLE_SHEET_URL, { method: "POST", mode: "no-cors", body: formData })
      .then(()=> console.log("Submitted to Google Sheets"));

    // Show success page
    document.getElementById("formPage").classList.add("hidden");
    document.getElementById("successPage").classList.remove("hidden");

    const MY_EMAIL = "your@email.com";
    const MY_WHATSAPP = "91XXXXXXXXXX"; // with country code
    document.getElementById("emailBtn").href = `mailto:${MY_EMAIL}?subject=Service Request: ${encodeURIComponent(req.service)}&body=${encodeURIComponent('Name: '+req.name+'\nEmail: '+req.email+'\nPhone: '+req.phone+'\nDetails: '+req.details)}`;
    document.getElementById("waBtn").href = `https://wa.me/${MY_WHATSAPP.replace(/\D/g,'')}?text=${encodeURIComponent('Hello, I submitted a request for: '+req.service+' (Name: '+req.name+')')}`;

    document.getElementById('backHome').addEventListener('click', ()=>{ window.location.href = 'index.html'; });
  });
});
</script>
</body>
</html>
